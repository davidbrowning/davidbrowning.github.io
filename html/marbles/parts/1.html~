<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Marbles</title>

<style>
	canvas {
		border: 4px solid #666;
		position: absolute;
		margin: auto;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
		background: #272727;
	}
</style>

<script>
	
var canvas, context;

var data;
var playerBlue;
var player = 1;
var occupiedSpaces = [];

function getPlayer(){
	return player;
}

function setPlayer(){
	if(player >= 4){
		player = 1;
	}
	else {
		player++;
	}
	document.getElementById("turn").innerHTML = "Player Turn: " + player;
	return;
}

window.onload = function main() {
	canvas = document.createElement("canvas");
	canvas.width = canvas.height = 580;
	context = canvas.getContext("2d");

	document.body.appendChild(canvas);
	canvas.addEventListener("mousedown", mouseDown);

	init();
	tick();
}
function init() {

	if(data == null){
		data = [];
		//render the empty edges of the board
		for (var i = 0; i < 78; i++){
			var x;
			var y;
			if(i<19){ //top
				y = 10;
				x = ((i%19)*30) + 10;
			}
			else if (i < 37){ //left
				x = 10;
				y = ((i%19)*30)+10;
				}
			else if (i < 56){ //right
				x = 550;				
				y = ((i%19)*30)+10;
			}
			else{
				y = 550; //bottom
				x = ((i%19)*30) + 10;
			}
			data.push(new Space(x, y, "grey"));
		}
		
		playerBlue = [];		

			y = ((8%18)*30) + 10;
			x = 40;
			playerBlue.push(new Space(x, y, "blueMarble.png"));

			
			y = ((8%18)*30) + 10;
			x = 70;
			playerBlue.push(new Space(x, y, "blueMarble.png"));
	
	
			y = ((8%18)*30) + 10;
			x = 100;
			playerBlue.push(new Space(x, y, "blueMarble.png"));

			y = ((7%18)*30) + 10;
			x = 70;
			playerBlue.push(new Space(x, y, "blueMarble.png"));

			y = ((9%18)*30) + 10;
			x = 70;
			playerBlue.push(new Space(x, y, "blueMarble.png"));

			
		playerGreen = [];		

			x = ((10%18)*30) + 10;
			y = 40;
			playerGreen.push(new Space(x, y, "greenMarble.png"));

			
			x = ((10%18)*30) + 10;
			y = 70;
			playerGreen.push(new Space(x, y, "greenMarble.png"));
	
	
			x = ((10%18)*30) + 10;
			y = 100;
			playerGreen.push(new Space(x, y, "greenMarble.png"));

			x = ((9%18)*30) + 10;
			y = 70;
			playerGreen.push(new Space(x, y, "greenMarble.png"));

			x = ((11%18)*30) + 10;
			y = 70;
			playerGreen.push(new Space(x, y, "greenMarble.png"));

		playerRed = [];		

			y = ((10%18)*30) + 10;
			x = 580-60;
			playerRed.push(new Space(x, y, "redMarble.png"));

			
			y = ((10%18)*30) + 10;
			x = 580-90;
			playerRed.push(new Space(x, y, "redMarble.png"));
	
	
			y = ((10%18)*30) + 10;
			x = 580-120;
			playerRed.push(new Space(x, y, "redMarble.png"));

			y = ((9%18)*30) + 10;
			x = 580-90;
			playerRed.push(new Space(x, y, "redMarble.png"));

			y = ((11%18)*30) + 10;
			x = 580-90;
			playerRed.push(new Space(x, y, "redMarble.png"));

			
		playerYellow = [];		

			x = ((8%18)*30) + 10;
			y = 580-60;
			playerYellow.push(new Space(x, y, "yellowMarble.png"));

			
			x = ((8%18)*30) + 10;
			y = 580-90;
			playerYellow.push(new Space(x, y, "yellowMarble.png"));
	
	
			x = ((8%18)*30) + 10;
			y = 580-120;
			playerYellow.push(new Space(x, y, "yellowMarble.png"));

			x = ((7%18)*30) + 10;
			y =  580-90;
			playerYellow.push(new Space(x, y, "yellowMarble.png"));

			x = ((9%18)*30) + 10;
			y =  580-90;
			playerYellow.push(new Space(x, y, "yellowMarble.png"));
	
	occupiedSpaces.push(playerBlue);
	occupiedSpaces.push(playerGreen);
	occupiedSpaces.push(playerRed);
	occupiedSpaces.push(playerYellow);
	}
}
function tick() {
	window.requestAnimationFrame(tick);
	
	update();
	render();	
}
function update() {
	for (var i = data.length; i--;){
		data[i].update();
	}
	for(var j = playerBlue.length; j--;){
		playerBlue[j].update();
		playerGreen[j].update();
		playerYellow[j].update();
		playerRed[j].update();
		
	}
}
function render() {
	context.clearRect(0,0,canvas.width, canvas.height);
	for(var i = data.length; i--;){
		data[i].draw(context);
	}
	for(var j = playerBlue.length; j--;){
		playerBlue[j].draw(context);
		playerGreen[j].draw(context);
		playerYellow[j].draw(context);
		playerRed[j].draw(context);
	}

}



function checkSpace(x, y){			//checkSpace will take the space the marble is going to and see if it is occupied. 
						//If occupied, it will return the Space object which is occupying it.
	for (var j = 0; j < 4; j++){
		for (var i = 0; i < 5; i++){
			if(occupiedSpaces[j][i].getx() == x){
				if(occupiedSpaces[j][i].gety() == y){
					alert("occupied space");
					return occupiedSpaces[j][i];
				}
			}
		}
	}
	return null;

}

function sendHome(x, y){ //Blue | Green | Red | Yellow
	var placex;
	var placey;
	for (var j = 0; j < 4; j++){
		for (var i = 0; i < 5; i++){
			if(occupiedSpaces[j][i].getx() == x){
				if(occupiedSpaces[j][i].gety() == y){
					if(j ==1){
						if(occupiedSpaces[j][i].gety() > 10){
							green();						
							occupiedSpaces[j][i].makeEmpty();
							occupiedSpaces[j][i] = new Space(placex,placey,"greenMarble.png");
						}
					}
				}
			}
		}
	}
	return;
	function green(){
		if(j = 1){ //color == Green
			console.log(placex + ","  +placey);
				placey = 40;
				placex = 310;
				var tempy = occupiedSpaces[j][i].gety();
				var tempx = occupiedSpaces[j][i].getx();
				if(tempy > 10 && tempy < 550){
					if (tempy == 40){
						placey = placey + 30;
						placex = placex - 30;
						return green();
					}
					else if(tempx == 280 || tempx == 310){
						placex = placex + 30;
						return green();
					}
					else{
						placex = 310;
						placey = 100;
					}	
				}	
			console.log(placex + ","  +placey);
			console.log(tempx + ", " + tempy);
		}
	}

}


//I need a way to keep track of turns. Ended up making each player turn a seperate function. Now to figure out how to specify how many moves the marble should
//make in a turn, or perhaps to fix the bug where colliding marble dissappear. 
function player1(px, py){
	for(var i = playerBlue.length; i--;){
		if(px > playerBlue[i].getx() && px < playerBlue[i].getx()+30){
			if(py>playerBlue[i].gety() && py < playerBlue[i].gety()+30){
				var tempx = playerBlue[i].getx();
				var tempy = playerBlue[i].gety();
				playerBlue[i].makeEmpty();
				if(tempx < 550 && tempy == 10){		//Moving around the board
					var goingTo = checkSpace(tempx+300, 10);
						if(goingTo == null){
							playerBlue[i] = new Space((tempx+300),10,"blueMarble.png");
							setPlayer();
						}
						else {
							if(goingTo.getcolor() == "blueMarble.png"){
								alert("one of your marbles is already there!");
							}
							else{ //send the marble home
								sendHome(tempx+300, 10);
								playerBlue[i] = new Space((tempx+300),10,"blueMarble.png");
								setPlayer();
							}
						}
					
				}
				else if(tempy < 550 && tempx == 550){	
					var goingTo = checkSpace(550, tempy+30);
					if(goingTo == null){
						playerBlue[i] = new Space(550,tempy+30,"blueMarble.png");
						setPlayer();
					}
					else{alert("occupied space, cannot move here!!");
					console.log(goingTo.getcolor())}
				
				}
				else if (tempx > 10 && tempy == 550){
					var goingTo = checkSpace(tempx-30, 550);
					if(goingTo == null){
						playerBlue[i] = new Space((tempx-30),550,"blueMarble.png");
						setPlayer();
					}
					else {alert("occupied space, cannot move here!!");}
				}
				else if (tempy > 10 && tempx == 10){
					var goingTo = checkSpace(10, tempy-(8*30));
					if(goingTo == null){
						playerBlue[i] = new Space(10,(tempy-(8*30)),"blueMarble.png"); // Augmenting (tempy-(x * 30)) will move you x spaces up.
						setPlayer();
					}
					else{
						alert("Occupied Space");
					}
			
				}
				else if(checkSpace(10,250)){
						alert("occupied space, cannot move here!!");
						}
						else{
							if(tempx == 70 && tempy == (8*30+10)){ //next 5 are if the marbles are home.
								playerBlue[i] = new Space(10,(8*30+10),"blueMarble.png");
								setPlayer();
							}
							else if(tempx == 40 && tempy == (8*30+10)){
								playerBlue[i] = new Space(10,(8*30+10),"blueMarble.png");
								setPlayer();
							}
							else if(tempx == 100 && tempy == (8*30+10)){
								playerBlue[i] = new Space(10,(8*30+10),"blueMarble.png");
								setPlayer();
							}
							else if(tempx == 70 && tempy == (7*30+10)){
								playerBlue[i] = new Space(10,(8*30+10),"blueMarble.png");
								setPlayer();
							}
							else if(tempx == 70 && tempy == (9*30+10)){
								playerBlue[i] = new Space(10,(8*30+10),"blueMarble.png");
								setPlayer();
							}
						}
			}
		}
	}
}

function player2(px, py){
	for(var i = playerGreen.length; i--;){
		 if(px > playerGreen[i].getx() && px < playerGreen[i].getx()+30){
			if(py>playerGreen[i].gety() && py < playerGreen[i].gety()+30){
				var tempx = playerGreen[i].getx();
				var tempy = playerGreen[i].gety();
				playerGreen[i].makeEmpty();
				if(tempx < 550 && tempy == 10){ // Moving around the board.
				playerGreen[i] = new Space((tempx+30),10,"greenMarble.png");
				setPlayer();
				}
				else if(tempy < 550 && tempx == 550){	
				playerGreen[i] = new Space(550,tempy+30,"greenMarble.png");
				setPlayer();
				}
				else if (tempx > 10 && tempy == 550){
				playerGreen[i] = new Space((tempx-30),550,"greenMarble.png");
				setPlayer();
				}
				else if (tempy > 10 && tempx == 10){
				playerGreen[i] = new Space(10,(tempy-30),"greenMarble.png");
				setPlayer();
				}
				else if(tempy == 70 && tempx == (10*30+10)){ //Getting out of home.
					playerGreen[i] = new Space((10*30+10),10,"greenMarble.png");
					setPlayer();
				}
				else if(tempy == 40 && tempx == (10*30+10)){
					playerGreen[i] = new Space((10*30+10),10,"greenMarble.png");
					setPlayer();
				}
				else if(tempy == 100 && tempx == (10*30+10)){
					playerGreen[i] = new Space((10*30+10),10,"greenMarble.png");
					setPlayer();
				}
				else if(tempy == 70 && tempx == (9*30+10)){
					playerGreen[i] = new Space((10*30+10),10,"greenMarble.png");
					setPlayer();
				}
				else if(tempy == 70 && tempx == (11*30+10)){
					playerGreen[i] = new Space((10*30+10),10,"greenMarble.png");
					setPlayer();
				}
			}
		}
	}
}

function player3(px, py){
	for(var i = playerRed.length; i--;){
		 if(px > playerRed[i].getx() && px < playerRed[i].getx()+30){
			if(py>playerRed[i].gety() && py < playerRed[i].gety()+30){
				var tempx = playerRed[i].getx();
				var tempy = playerRed[i].gety();
				playerRed[i].makeEmpty();
				if(tempx < 550 && tempy == 10){
				playerRed[i] = new Space((tempx+30),10,"redMarble.png");
				setPlayer();
				}
				else if(tempy < 550 && tempx == 550){	
				playerRed[i] = new Space(550,tempy+30,"redMarble.png");
				setPlayer();
				}
				else if (tempx > 10 && tempy == 550){
				playerRed[i] = new Space((tempx-30),550,"redMarble.png");
				setPlayer();
				}
				else if (tempy > 10 && tempx == 10){
				playerRed[i] = new Space(10,(tempy-30),"redMarble.png");
				setPlayer();
				}
				else if(tempx == 580-60 && tempy == (10*30+10)){
					playerRed[i] = new Space(550,(10*30+10),"redMarble.png");
					setPlayer();
				}
				else if(tempx == 580-90 && tempy == (10*30+10)){
					playerRed[i] = new Space(550,(10*30+10),"redMarble.png");
					setPlayer();
				}
				else if(tempx == 580-120 && tempy == (10*30+10)){
					playerRed[i] = new Space(550,(10*30+10),"redMarble.png");
					setPlayer();
				}
				else if(tempx == 490 && tempy == (9*30+10)){
					playerRed[i] = new Space(550,(10*30+10),"redMarble.png");
					setPlayer();
				}
				else if(tempx == 490 && tempy == (11*30+10)){
					playerRed[i] = new Space(550,(10*30+10),"redMarble.png");
					setPlayer();
				}
			}
		}
	}
}

function player4(px, py){
	for(var i = playerYellow.length; i--;){
	 	if(px > playerYellow[i].getx() && px < playerYellow[i].getx()+30){
			if(py>playerYellow[i].gety() && py < playerYellow[i].gety()+30){
				var tempx = playerYellow[i].getx();
				var tempy = playerYellow[i].gety();
				playerYellow[i].makeEmpty();
				if(tempx < 550 && tempy == 10){
				playerYellow[i] = new Space((tempx+30),10,"yellowMarble.png");
				setPlayer();
				}
				else if(tempy < 550 && tempx == 550){	
				playerYellow[i] = new Space(550,tempy+30,"yellowMarble.png");
				setPlayer();
				}
				else if (tempx > 10 && tempy == 550){
				playerYellow[i] = new Space((tempx-30),550,"yellowMarble.png");
				setPlayer();
				}
				else if (tempy > 10 && tempx == 10){
				playerYellow[i] = new Space(10,(tempy-30),"yellowMarble.png");
				setPlayer();
				}
				else if(tempy == 520 && tempx == (8*30+10)){
					playerYellow[i] = new Space((8*30+10),550,"yellowMarble.png");
					setPlayer();
				}
				else if(tempy == 490 && tempx == (8*30+10)){
					playerYellow[i] = new Space((8*30+10),550,"yellowMarble.png");
					setPlayer();
				}
				else if(tempy == 460 && tempx == (8*30+10)){
					playerYellow[i] = new Space((8*30+10),550,"yellowMarble.png");
					setPlayer();
				}
				else if(tempy == 490 && tempx == (7*30+10)){
					playerYellow[i] = new Space((8*30+10),550,"yellowMarble.png");
					setPlayer();
				}
				else if(tempy == 490 && tempx == (9*30+10)){
					playerYellow[i] = new Space((8*30+10),550,"yellowMarble.png");
					setPlayer();
				}
			}
		}
	}
}
function mouseDown(event) {
	var player = getPlayer();
	console.log(player);

	var el = event.target;
	var px = event.clientX - el.offsetLeft;
	var py = event.clientY - el.offsetTop;

		if (player == 1){
			player1(px, py);
		}
		else if (player == 2){
			player2(px, py);
		}
		else if (player == 3){
			player3(px, py);
		}
		else if (player == 4){
			player4(px, py);
		}

	
	update();
	render();



}
function Player(color, marbles){

}

function marbles(x, y){

}

function Space(x, y, color) {
	var x = x, y = y;
	var empty = false;
	var space = Space.BLUE;
	if(space == null){
		var _c = document.createElement("canvas");
		_c.width = _c. height = 20;
		_context = _c.getContext("2d");
		//_context.fillStyle = color;
		_context.fillRect(0,0,20,20);
		//BLANK
		Space.BLANK = new Image();
		//Space.BLANK.src = _c.toDataURL();
		Space.BLANK.src = ("blankspace.png");
		//FILLED

		if(color == "grey"){
			space = Space.BLANK;
			empty = true;
		}
		else{
		Space.FILLED = new Image();
		Space.FILLED.src = color;
		space = Space.FILLED	
		}	
	}

	this.getx = function(){
		return x;
	}

	this.gety = function(){
		return y;
	}

	this.getcolor = function(){
		return color;
	}

	this.makeEmpty = function(){
		//space = Space.BLANK;
		//context.drawImage(space,x,y);
		data.push(new Space(x, y, "grey"));
		empty = true;
	}

	this.update = function(){

	}
	this.draw = function(context){
		context.drawImage(space, x, y);
	}
}
</script>
</head>
<body>
	<h1 id = "turn">Player 1 Starts!</h1>	
</body>
</html>
